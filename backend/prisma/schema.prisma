// This is your Prisma schema file

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  extensions = [vector]
}

model Post {
  id          String   @id @default(cuid())
  post_id     String?
  board       String?
  timestamp   DateTime // The timestamp of the actual post, not the time it was uploaded
  poster      String   @default("Anonymous")
  uploaded_at DateTime @default(now()) // The time the post was uploaded
  is_nsfw     Boolean  @default(false)
  url         String?
  contentId   String   @unique
  imageId     String?
  content     Content  @relation(fields: [contentId], references: [id])
  image       Image?   @relation(fields: [imageId], references: [id])

  @@index([post_id])
  @@index([timestamp])
}

model Content {
  id        String   @id @default(cuid())
  greentext String[] // Array of greentext lines
  text      String[] // Array of regular text lines
  post      Post? // One-to-one relation with Post
  embedding Float[] // OpenAI embeddings are 1536 dimensions

  // Full-text search indexes (if using PostgreSQL)
  @@index([greentext])
  @@index([text])
}

model Image {
  id          String  @id @default(cuid())
  filename    String?
  size        String?
  format      String?
  dimensions  String?
  description String? // Image description for accessibility and searching
  posts       Post[] // One-to-many relation with Post

  @@index([filename])
}
